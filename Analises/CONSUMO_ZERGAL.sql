--Consumo em kilos de cada OP produzida entre 07/2022 e 07/2024 (VERSÃO 1)
SELECT A.D3_OP,
	B.H6_PRODUTO,
	A.QNT_CONSUMIDA,
	B.QNT_PRODUZIDA
	FROM 
		(SELECT D3_OP, D3_COD,  SUM(D3_QUANT) AS QNT_CONSUMIDA
			 FROM SD3010
			 WHERE D3_COD = 'BR00000020068G' 
	 			AND D3_EMISSAO BETWEEN '20230701' AND '20240701' 
				AND D3_TM = '999'
				AND D3_LOCAL = '01'
			 GROUP BY D3_OP, D3_COD) A
	JOIN
		(SELECT H6_OP, H6_PRODUTO, SUM(H6_QTDPROD) AS QNT_PRODUZIDA
			 FROM SH6010
			 WHERE SH6010.D_E_L_E_T_ <> '*' 
				AND H6_RECURSO LIKE 'F%'
			 GROUP BY H6_OP, 
				H6_PRODUTO) B ON A.D3_OP = B.H6_OP
	ORDER BY QNT_CONSUMIDA DESC, 
		QNT_PRODUZIDA DESC;

--QUANTIDADE DE PEÇAS PRODUZIDAS PELAS PEÇAS QUE CONSUMIRAM DA MP 20068G (VERSÃO 2) ---------------------------------------------------------------------------

SELECT A.D3_OP,	
	A.D3_COD AS MP, 
	B.D3_COD , 
	A.PESO_KGS, 
	B.PECAS
	FROM
		(SELECT D3_TM, D3_OP, D3_COD, SUM(D3_QUANT) AS PESO_KGS
			FROM SD3010
			WHERE D3_TM = '999'
				AND D3_COD NOT LIKE 'MOD%'
				AND D3_OP IN ('A00RYJ01001','A00UCP01001','A00REK01001','A00SJZ01001','A00SR701001','A00SUM01001','A00VX301003',
				'A00VGY01001','A00WVX01001','A00TAU01001','A00TOU01001','A00VMZ01001','A00YVD01001','A00WL101001','A00UI801001',
				'A00YZU01001','A00ZD001001','A00XU801001','A00U8801001','A00XCB01001','A00WP101003','A00XZH01001','A00Y0801003',
				'A00YHT01001','A00UNB01001','A00URK01003','A00SEE01001','A00WSZ01001','A00XN201001','A00XX001001','A00STL01001',
				'A00SMW01002','A00UVV01003','A00RT701001','A00XTC01003','A00YGM01001','A00TAT01002','A00YLP01001','A00ZD101001',
				'A00URL01003','A00XTD01001','A00SKS01003','A00XYE01003','A00YCC01001','A00UZQ01001','A00V4901001','A00V2701001',
				'A00V4201001','A00STE01003','A00SON01002','A00SKV01003','A00YHO01003','A00WBI01003','A00SOD01003','A00SPW01003')
			GROUP BY D3_TM, 
				D3_OP, 
				D3_COD) A
	LEFT JOIN 
		(SELECT D3_TM, 
			D3_OP, 
			D3_COD, 
			SUM(D3_QUANT) AS PECAS
			FROM SD3010
			WHERE D3_TM = '010'
				AND D3_COD NOT LIKE 'MOD%'
				AND D3_OP IN ('A00RYJ01001','A00UCP01001','A00REK01001','A00SJZ01001','A00SR701001','A00SUM01001','A00VX301003',
				'A00VGY01001','A00WVX01001','A00TAU01001','A00TOU01001','A00VMZ01001','A00YVD01001','A00WL101001','A00UI801001',
				'A00YZU01001','A00ZD001001','A00XU801001','A00U8801001','A00XCB01001','A00WP101003','A00XZH01001','A00Y0801003',
				'A00YHT01001','A00UNB01001','A00URK01003','A00SEE01001','A00WSZ01001','A00XN201001','A00XX001001','A00STL01001',
				'A00SMW01002','A00UVV01003','A00RT701001','A00XTC01003','A00YGM01001','A00TAT01002','A00YLP01001','A00ZD101001',
				'A00URL01003','A00XTD01001','A00SKS01003','A00XYE01003','A00YCC01001','A00UZQ01001','A00V4901001','A00V2701001',
				'A00V4201001','A00STE01003','A00SON01002','A00SKV01003','A00YHO01003','A00WBI01003','A00SOD01003','A00SPW01003')
			GROUP BY D3_TM, 
				D3_OP, 
				D3_COD) B ON B.D3_OP = A.D3_OP
	GROUP BY A.D3_OP, 
		A.D3_COD,
		B.D3_COD, 
		A.PESO_KGS,
		B.PECAS

--VERSÃO EDNALDO ----------------------------------------------------------------------------------------


SELECT D3_OP, D3_COD, SUM(D3_QUANT) D3QUANT, H6_OP, H6_PRODUTO, H6QUANT FROM SD3010

LEFT JOIN (SELECT H6_OP, H6_PRODUTO, SUM(H6_QTDPROD) H6QUANT

       FROM SH6010 WHERE SH6010.D_E_L_E_T_ <> '*' AND H6_RECURSO LIKE 'F%'

       GROUP BY H6_OP, H6_PRODUTO) B ON D3_OP = B.H6_OP

WHERE D3_COD = 'BR00000020068G'

        AND D3_EMISSAO BETWEEN '20220701' AND '20240701' AND D3_TM = '999' AND D3_LOCAL = '01'

       GROUP BY D3_OP, D3_COD, D3_OP, D3_COD, H6_OP, H6_PRODUTO, H6QUANT

--PEÇAS PRODUZIDAS NO PERIODO, QUE UTILIZAM A MP 200068G---------------------------------------------------------------------------------------------------------------

SELECT A.G1_COMP, D3_COD, SUM(D3_QUANT) AS PRO_PECAS

FROM SD3010 INNER JOIN

	(SELECT G1_COD, G1_COMP, G1_QUANT

	FROM SG1010

	WHERE G1_COMP IN ('0021407S','0021408S','0023333S','0024040S','0024055S','3021669S','3420731S','SA00418067-010','SA00425110-010')
		AND SG1010.D_E_L_E_T_ = '') A

ON G1_COD = D3_COD

WHERE D3_EMISSAO BETWEEN '20220701' AND '20240701' 	AND D3_TM = '010'

GROUP BY A.G1_COMP, D3_COD

ORDER BY PRO_PECAS DESC

--CONSUMO DA ESTRUTURA (DO S NO L)----------------------------------------------------------------------------------------------------------------------------

SELECT G1_COD, G1_COMP, G1_QUANT
FROM SG1010
WHERE SG1010.D_E_L_E_T_ = ''
	AND G1_COD IN ('0023333L',
		'0024055L',
		'4220300L',
		'SA000000418067',
		'0021631L',
		'4220310L',
		'SA00000021407N',
		'0024040L',
		'4220301L',
		'4220304L',
		'3021669L',
		'3420733L',
		'3021173L',
		'3420731L',
		'4220312L',
		'0024046L',
		'SA000000425110',
		'SA000000425109',
		'0024041L',
		'3021678L',
		'0024079L',
		'4220311L',
		'4220302L',
		'SA000000418068',
		'SA000000418069',
		'SA00000021408N',
		'SA000000425126',
		'SA000000425125',
		'4220313L',
		'0024042L',
		'3021670L',
		'0024047L',
		'3021174L',
		'0021656L',
		'0021657L',
		'0024044L',
		'0024045L',
		'0021834L',
		'4220321L',
		'0024080L',
		'0024081L',
		'3420734L',
		'3021206L',
		'3021679L',
		'00416723L',
		'3420732L',
		'3021680L',
		'4220320L',
		'0024048L',
		'0024082L')
		AND G1_COMP NOT LIKE 'MOD%'



SELECT D3_COD, 
	SUM(D3_QUANT)
	FROM SD3010
	WHERE D3_COD IN('0024055L')
		AND D3_EMISSAO BETWEEN '20220701' AND '20240701'
		AND D3_TM = '010'
	GROUP BY D3_COD